<!DOCTYPE html>
<html>
<head>
    <title>ZFS Monitor</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            padding: 20px;
            background: #f5f5f5;
            max-width: 1200px;
            margin: 0 auto;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border-radius: 4px;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        th {
            background: #f8f9fa;
            font-weight: 600;
        }
        tr:hover {
            background: #f8f9fa;
        }
        .timestamp {
            color: #666;
            font-size: 0.9em;
            margin: 10px 0;
        }
        .error {
            color: red;
            padding: 10px;
            display: none;
        }
    </style>
</head>
<body>
    <h1>ZFS Monitor</h1>
    <div class="timestamp" id="lastUpdate"></div>
    <div class="error" id="error">Connection lost. Attempting to reconnect...</div>
    <table>
        <thead>
            <tr>
                <th>Name</th>
                <th>Used</th>
                <th>Avail</th>
                <th>Refer</th>
                <th>Mountpoint</th>
            </tr>
        </thead>
        <tbody id="output"></tbody>
    </table>

    <script>
        function connect() {
            const ws = new WebSocket('wss://zfs.home.urandom.io/ws');
            const errorDiv = document.getElementById('error');

            ws.onmessage = function(event) {
                try {
                    errorDiv.style.display = 'none';
                    const lines = event.data.trim().split(';');
                    let html = '';

                    lines.forEach(line => {
                        if (!line.trim()) return;
                        const parts = line.trim().split(/\s+/);
                        if (parts.length >= 5) {
                            html += `<tr>
                                <td>${parts[0]}</td>
                                <td>${parts[1]}</td>
                                <td>${parts[2]}</td>
                                <td>${parts[3]}</td>
                                <td>${parts[4]}</td>
                            </tr>`;
                        }
                    });

                    document.getElementById('output').innerHTML = html;
                    document.getElementById('lastUpdate').textContent =
                        'Last Updated: ' + new Date().toLocaleString();
                } catch (e) {
                    console.error('Error parsing data:', e);
                }
            };

            ws.onclose = function() {
                errorDiv.style.display = 'block';
                setTimeout(connect, 1000);
            };

            ws.onerror = function() {
                errorDiv.style.display = 'block';
            };
        }

        connect();
    </script>
</body>
</html>
